Mostly written by ai but still personally debugged
